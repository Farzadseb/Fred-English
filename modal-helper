/**
 * Modal Helper - Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ù†Ø¬Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´
 */

const ModalHelper = {
    /**
     * Ù†Ù…Ø§ÛŒØ´ modal Ø³ÙØ§Ø±Ø´ÛŒ
     */
    showCustomModal(title, content, onClose = null) {
        // Ø­Ø°Ù modal Ù‚Ø¨Ù„ÛŒ
        this.closeCustomModal();
        
        // Ø§ÛŒØ¬Ø§Ø¯ modal Ø¬Ø¯ÛŒØ¯
        const modalId = 'custom-modal-' + Date.now();
        const modalHTML = `
            <div id="${modalId}" class="custom-modal active">
                <div class="custom-modal-content">
                    <div class="custom-modal-header">
                        <h2>${title}</h2>
                        <button class="modal-close-btn" onclick="ModalHelper.closeModal('${modalId}')">Ã—</button>
                    </div>
                    <div class="custom-modal-body">
                        ${content}
                    </div>
                </div>
            </div>
        `;
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Ø°Ø®ÛŒØ±Ù‡ callback Ø¨Ø³ØªÙ†
        if (onClose) {
            window[`modalCloseCallback_${modalId}`] = onClose;
        }
        
        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾Ø´Øª modal
        document.body.style.overflow = 'hidden';
        
        // focus Ø±ÙˆÛŒ modal
        setTimeout(() => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.focus();
            }
        }, 100);
    },
    
    /**
     * Ø¨Ø³ØªÙ† modal Ø®Ø§Øµ
     */
    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
            
            // Ø§Ø¬Ø±Ø§ÛŒ callback Ø¨Ø³ØªÙ†
            const callbackName = `modalCloseCallback_${modalId}`;
            if (window[callbackName]) {
                window[callbackName]();
                delete window[callbackName];
            }
            
            // Ø­Ø°Ù modal Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
            setTimeout(() => {
                modal.remove();
                
                // Ø§Ú¯Ø± modal Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†
                if (!document.querySelector('.custom-modal')) {
                    document.body.style.overflow = 'auto';
                }
            }, 300);
        }
    },
    
    /**
     * Ø¨Ø³ØªÙ† Ù‡Ù…Ù‡ modal Ù‡Ø§
     */
    closeCustomModal() {
        const modals = document.querySelectorAll('.custom-modal');
        modals.forEach(modal => {
            modal.classList.remove('active');
            setTimeout(() => {
                modal.remove();
            }, 300);
        });
        
        // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÙˆÙ„
        document.body.style.overflow = 'auto';
        
        // Ø­Ø°Ù Ù‡Ù…Ù‡ callbacks
        Object.keys(window).forEach(key => {
            if (key.startsWith('modalCloseCallback_')) {
                delete window[key];
            }
        });
    },
    
    /**
     * Ù†Ù…Ø§ÛŒØ´ modal ØªØ£ÛŒÛŒØ¯
     */
    showConfirmModal(title, message, onConfirm, onCancel = null) {
        const content = `
            <div class="confirm-modal">
                <p>${message}</p>
                <div class="confirm-buttons">
                    <button class="btn btn-primary" onclick="ModalHelper.handleConfirm('${Date.now()}')">
                        ØªØ£ÛŒÛŒØ¯
                    </button>
                    <button class="btn btn-secondary" onclick="ModalHelper.closeCustomModal()">
                        Ø§Ù†ØµØ±Ø§Ù
                    </button>
                </div>
            </div>
        `;
        
        const modalId = 'confirm-modal-' + Date.now();
        
        // Ø°Ø®ÛŒØ±Ù‡ callbacks
        window[`confirmCallback_${modalId}`] = onConfirm;
        if (onCancel) {
            window[`cancelCallback_${modalId}`] = onCancel;
        }
        
        this.showCustomModal(title, content, () => {
            // Ø§Ø¬Ø±Ø§ÛŒ callback Ø§Ù†ØµØ±Ø§Ù
            const cancelCallback = window[`cancelCallback_${modalId}`];
            if (cancelCallback) {
                cancelCallback();
            }
            
            // Ø­Ø°Ù callbacks
            delete window[`confirmCallback_${modalId}`];
            delete window[`cancelCallback_${modalId}`];
        });
    },
    
    /**
     * Ù…Ø¯ÛŒØ±ÛŒØª ØªØ£ÛŒÛŒØ¯
     */
    handleConfirm(modalId) {
        const callback = window[`confirmCallback_${modalId}`];
        if (callback) {
            callback();
        }
        
        // Ø­Ø°Ù callbacks
        delete window[`confirmCallback_${modalId}`];
        delete window[`cancelCallback_${modalId}`];
        
        // Ø¨Ø³ØªÙ† modal
        this.closeCustomModal();
    },
    
    /**
     * Ù†Ù…Ø§ÛŒØ´ modal Ø§Ø·Ù„Ø§Ø¹Ø§Øª
     */
    showInfoModal(title, message, icon = 'â„¹ï¸') {
        const content = `
            <div class="info-modal">
                <div class="info-icon">${icon}</div>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="ModalHelper.closeCustomModal()">
                    ÙÙ‡Ù…ÛŒØ¯Ù…
                </button>
            </div>
        `;
        
        this.showCustomModal(title, content);
    },
    
    /**
     * Ù†Ù…Ø§ÛŒØ´ modal Ø¯Ø³ØªØ§ÙˆØ±Ø¯
     */
    showAchievementModal(title, message, icon = 'ğŸ†') {
        const content = `
            <div class="achievement-modal">
                <div class="achievement-icon">${icon}</div>
                <h3>${title}</h3>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="ModalHelper.closeCustomModal()">
                    Ø¹Ø§Ù„ÛŒ! Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ù…
                </button>
            </div>
        `;
        
        this.showCustomModal('Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯! ğŸ‰', content);
    }
};

// Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ
window.showCustomModal = (title, content) => ModalHelper.showCustomModal(title, content);
window.closeCustomModal = () => ModalHelper.closeCustomModal();
window.ModalHelper = ModalHelper;
