<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz - English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b1426; --blue: #00a8ff; --green: #00b894; --red: #d63031; --text: #1e293b; --card: #ffffff; }
        body.light-mode { --bg: #f1f5f9; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 10px; overflow: hidden; transition: 0.3s; }

        .top-bar { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .control-btn { background: #1e293b; border: none; color: var(--blue); width: 42px; height: 42px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .progress-bar { width: 95%; max-width: 380px; height: 8px; background: #334155; border-radius: 10px; margin-bottom: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--green); width: 0%; transition: 0.4s; }

        /* کادر سفید - ۲۰ درصد کوچکتر از همه طرف */
        .q-card { 
            background: var(--card); 
            color: var(--text); 
            padding: 12px; 
            border-radius: 20px; 
            width: 75%; /* کاهش عرض کادر */
            max-width: 320px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.4); 
            margin: 20px auto; /* ایجاد فاصله از بالا و پایین */
        }

        .audio-btn { background: var(--blue); color: white; border: none; width: 42px; height: 42px; border-radius: 50%; font-size: 16px; cursor: pointer; margin-bottom: 8px; }
        .question-text { font-size: 18px; font-weight: bold; margin-bottom: 12px; color: #2d3436; min-height: 40px; display: flex; align-items: center; justify-content: center; }

        .options-grid { width: 100%; display: flex; flex-direction: column; gap: 6px; }
        
        .opt-btn { 
            width: 100%;
            height: 48px; /* دکمه‌های پاسخ کوچک و بهینه */
            padding: 0 10px;
            font-size: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            background: white;
            color: var(--text);
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .opt-btn:active { transform: scale(0.98); }
        .opt-btn.correct { background: var(--green) !important; color: white !important; border-color: var(--green) !important; }
        .opt-btn.wrong { background: var(--red) !important; color: white !important; border-color: var(--red) !important; }
        .opt-btn.disabled { opacity: 0.8; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="top-bar">
        <button class="control-btn" onclick="window.location.href='index.html'"><i class="fas fa-home"></i></button>
        <div id="score-display" style="font-weight: bold; color: var(--blue);">امتیاز: 0</div>
    </div>
    <div class="progress-bar"><div id="fill" class="progress-fill"></div></div>
    <div id="quiz-content" style="width:100%; display:flex; justify-content:center;"></div>

    <script src="a1-words.js"></script>
    <script>
        let session = { mode: localStorage.getItem('quizMode') || 'fa-en', questions: [], index: 0, score: 0, answered: false };

        function render() {
            const q = session.questions[session.index];
            session.answered = false;
            document.getElementById('fill').style.width = ((session.index + 1) / 10 * 100) + "%";
            document.getElementById('score-display').innerText = `امتیاز: ${session.score}`;

            let qTxt = "", aCor = "";
            if (session.mode === 'fa-en') { qTxt = q.translation; aCor = q.word; }
            else if (session.mode === 'en-fa') { qTxt = q.word; aCor = q.translation; }
            else if (session.mode === 'word-def') { qTxt = q.word; aCor = q.definition; }
            else { qTxt = q.definition; aCor = q.word; }

            let opts = [aCor];
            while(opts.length < 4) {
                let r = window.wordsA1[Math.floor(Math.random()*window.wordsA1.length)];
                let o = (session.mode === 'fa-en' || session.mode === 'def-word') ? r.word : (session.mode === 'en-fa' ? r.translation : r.definition);
                if(!opts.includes(o)) opts.push(o);
            }
            opts.sort(() => Math.random() - 0.5);

            document.getElementById('quiz-content').innerHTML = `
                <div class="q-card">
                    <button class="audio-btn" onclick="speak('${q.word}')"><i class="fas fa-volume-up"></i></button>
                    <div class="question-text">${qTxt}</div>
                    <div class="options-grid">${opts.map(o => `<button class="opt-btn" onclick="check('${o}','${aCor}')">${o}</button>`).join('')}</div>
                </div>`;

            // پخش خودکار بلافاصله پس از نمایش سوال
            setTimeout(() => { speak(q.word); }, 300);
        }

        function check(sel, cor) {
            if(session.answered) return; session.answered = true;
            const btns = document.querySelectorAll('.opt-btn');
            btns.forEach(b => {
                if(b.innerText === cor) b.classList.add('correct');
                if(b.innerText === sel && sel !== cor) b.classList.add('wrong');
                b.disabled = true;
            });
            if(sel === cor) session.score++;
            setTimeout(() => { session.index++; session.index < 10 ? render() : finish(); }, 1200);
        }

        function finish() {
            const p = (session.score / 10) * 100;
            if(p > (localStorage.getItem('fredBest')||0)) localStorage.setItem('fredBest', p);
            alert(`نمره شما: ${p}%`); window.location.href = 'index.html';
        }

        function speak(t) { 
            if(localStorage.getItem('fredMute')!=='true') { 
                speechSynthesis.cancel(); 
                let m = new SpeechSynthesisUtterance(t); 
                m.lang='en-US'; 
                m.rate = 0.5; // تنظیم سرعت روی ۰.۵
                speechSynthesis.speak(m); 
            } 
        }

        window.onload = () => { session.questions = [...window.wordsA1].sort(()=>0.5-Math.random()).slice(0,10); render(); };
    </script>
</body>
</html>
