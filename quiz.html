<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz - English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --bg: #0b1426; --title: #ffffff; 
            --glass: rgba(255, 255, 255, 0.1);
        }
        body.light-mode { 
            --bg: #f2f2f7; --title: #000000; 
            --glass: rgba(255, 255, 255, 0.5);
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background: var(--bg); margin: 0; display: flex; flex-direction: column; 
            align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box;
            transition: 0.3s; color: var(--title);
        }

        /* Ù‡Ø¯Ø± Ú©ÙˆÛŒÛŒØ² */
        .quiz-header {
            width: 100%; max-width: 500px; display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 30px;
        }

        .back-btn {
            width: 40px; height: 40px; border-radius: 50%; background: var(--glass);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
        }

        /* Ú©Ø§Ø¯Ø± Ø³ÙˆØ§Ù„ Ø¨Ø±Ø§Ù‚ */
        .question-card {
            width: 100%; max-width: 500px; background: var(--glass);
            border-radius: 30px; padding: 40px 20px; text-align: center;
            backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); margin-bottom: 25px;
            position: relative; overflow: hidden;
        }

        /* Ø§ÙÚ©Øª Ø¨Ø±Ø§Ù‚ Ø±ÙˆÛŒ Ú©Ø§Ø¯Ø± Ø³ÙˆØ§Ù„ */
        .question-card::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
        }

        #question-text { font-size: 28px; font-weight: 800; margin: 0; color: #5856d6; }
        #q-subtext { font-size: 14px; opacity: 0.6; margin-top: 10px; }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ */
        .options-grid { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 12px; }

        .option-btn {
            width: 100%; padding: 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            background: var(--glass); color: var(--title); font-size: 17px; font-weight: 600;
            cursor: pointer; transition: 0.2s; backdrop-filter: blur(10px);
            text-align: center; position: relative; overflow: hidden;
        }

        .option-btn:active { transform: scale(0.97); }

        /* Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ùˆ ØºÙ„Ø· */
        .correct { background: #34c759 !important; color: white !important; border: none; box-shadow: 0 0 20px rgba(52, 199, 89, 0.4); }
        .wrong { background: #ff3b30 !important; color: white !important; border: none; }

        /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª */
        .progress-container { width: 100%; max-width: 500px; height: 6px; background: var(--glass); border-radius: 3px; margin-bottom: 10px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: #5856d6; transition: 0.3s; }
    </style>
</head>
<body class="light-mode">

    <div class="quiz-header">
        <div class="back-btn" onclick="confirmExit()"><i class="fas fa-times"></i></div>
        <div id="q-counter" style="font-weight: 700;">Ø³ÙˆØ§Ù„ 1 Ø§Ø² 10</div>
        <div style="width: 40px;"></div> 
    </div>

    <div class="progress-container">
        <div id="progress-bar"></div>
    </div>

    <div class="question-card">
        <h2 id="question-text">---</h2>
        <div id="q-subtext">ØªØ±Ø¬Ù…Ù‡ ØµØ­ÛŒØ­ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
    </div>

    <div class="options-grid" id="options-container">
        </div>

    <script src="a1-words.js"></script>
    <script>
        let currentQ = 0;
        let score = 0;
        let quizWords = [];
        const mode = localStorage.getItem('qMode');

        // Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ
        const motivations = {
            exit: ["Ø­ÛŒÙ Ø´Ø¯! Ù‚Ù‡Ø±Ù…Ø§Ù†â€ŒÙ‡Ø§ Ù†ÛŒÙ…Ù‡â€ŒÚ©Ø§Ø±Ù‡ Ø±Ù‡Ø§ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†. Ø¨Ø±Ú¯Ø±Ø¯ Ùˆ ØªÙ…ÙˆÙ…Ø´ Ú©Ù†! ğŸ’ª", "ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø±Ø§Ø² Ù…ÙˆÙÙ‚ÛŒØªÙ‡. ÙØ±Ø¯Ø§ Ù…Ù†ØªØ¸Ø±ØªÙ…! ğŸ”¥"],
            perfect: ["ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡ Ø¨ÙˆØ¯! Ø¨Ø§ Ø§ÛŒÙ† Ø³Ø±Ø¹Øª Ø¨Ø±ÛŒ Ø¢ÛŒÙ„ØªØ³ Ù…Ø«Ù„ Ø¢Ø¨ Ø®ÙˆØ±Ø¯Ù†Ù‡. ğŸš€", "Ø¹Ø§Ù„ÛŒ Ù‡Ø³ØªÛŒ! Ù¾ÛŒØ´Ø±ÙØªØª Ø®ÛŒØ±Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒØ³Øª. â­"],
            good: ["Ø®ÙˆØ¨ Ø¨ÙˆØ¯! Ú©Ù…ÛŒ ØªÙ…Ø±Ú©Ø² Ø¨ÛŒØ´ØªØ± ØªÙˆ Ø±Ùˆ Ø¨Ù‡ Ù†Ù…Ø±Ù‡ Û· Ø¢ÛŒÙ„ØªØ³ Ù…ÛŒâ€ŒØ±Ø³ÙˆÙ†Ù‡. ğŸ“ˆ"]
        };

        function initQuiz() {
            // Ø§Ù†ØªØ®Ø§Ø¨ Û±Û° Ú©Ù„Ù…Ù‡ ØªØµØ§Ø¯ÙÛŒ
            quizWords = [...words].sort(() => 0.5 - Math.random()).slice(0, 10);
            showQuestion();
        }

        function showQuestion() {
            if (currentQ >= 10) return finish();

            const q = quizWords[currentQ];
            const bar = document.getElementById('progress-bar');
            bar.style.width = ((currentQ + 1) / 10) * 100 + "%";
            document.getElementById('q-counter').innerText = `Ø³ÙˆØ§Ù„ ${currentQ + 1} Ø§Ø² 10`;

            let qText, correctAns;
            if (mode === 'fa-en') {
                qText = q.translation;
                correctAns = q.word;
                document.getElementById('q-subtext').innerText = "Ù…Ø¹Ø§Ø¯Ù„ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯";
            } else if (mode === 'en-fa') {
                qText = q.word;
                correctAns = q.translation;
                document.getElementById('q-subtext').innerText = "Ù…Ø¹Ø§Ø¯Ù„ ÙØ§Ø±Ø³ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯";
            } else {
                qText = q.word;
                correctAns = q.definition;
                document.getElementById('q-subtext').innerText = "ØªØ¹Ø±ÛŒÙ ØµØ­ÛŒØ­ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯";
            }

            document.getElementById('question-text').innerText = qText;

            // Ù…Ù†Ø·Ù‚ Ù‡ÙˆØ´Ù…Ù†Ø¯ ØµØ¯Ø§: Ø§Ú¯Ø± ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨ÙˆØ¯ Ù¾Ø®Ø´ Ù†Ø´ÙˆØ¯ ØªØ§ Ø¬ÙˆØ§Ø¨ Ù„Ùˆ Ù†Ø±ÙˆØ¯
            if (localStorage.getItem('forceMute') !== 'true' && localStorage.getItem('fMute') !== 'true') {
                speak(q.word);
            }

            // Ø³Ø§Ø®Øª Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
            let options = [correctAns];
            while (options.length < 4) {
                let r = words[Math.floor(Math.random() * words.length)];
                let val = (mode === 'fa-en') ? r.word : (mode === 'en-fa' ? r.translation : r.definition);
                if (!options.includes(val)) options.push(val);
            }
            options.sort(() => 0.5 - Math.random());

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, correctAns);
                container.appendChild(btn);
            });
        }

        function checkAnswer(btn, selected, correct) {
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.style.pointerEvents = 'none');

            if (selected === correct) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                // Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø¬ÙˆØ§Ø¨ ØµØ­ÛŒØ­
                allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
            }

            setTimeout(() => {
                currentQ++;
                showQuestion();
            }, 1200);
        }

        function finish() {
            let percent = (score / 10) * 100;
            let lastBest = localStorage.getItem('bestScore') || 0;
            localStorage.setItem('bestScore', Math.max(percent, lastBest));

            let msg = percent >= 80 ? motivations.perfect[0] : motivations.good[0];
            alert(`Ø¢Ø²Ù…ÙˆÙ† ØªÙ…Ø§Ù… Ø´Ø¯!\nØ§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${percent}%\n\n${msg}`);
            location.href = 'index.html';
        }

        function confirmExit() {
            if (confirm(motivations.exit[0])) {
                location.href = 'index.html';
            }
        }

        function speak(text) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }

        if (localStorage.getItem('fTheme') === 'dark') document.body.classList.remove('light-mode');
        initQuiz();
    </script>
</body>
</html>
