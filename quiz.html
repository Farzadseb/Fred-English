<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz - English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b1426; --blue: #00a8ff; --green: #00b894; --red: #d63031; --text: #1e293b; --card: #ffffff; }
        body.light-mode { --bg: #f1f5f9; --text: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: white; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 10px; overflow: hidden; transition: 0.3s; }

        .top-bar { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .control-btn { background: #1e293b; border: none; color: var(--blue); width: 38px; height: 38px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .progress-bar { width: 95%; max-width: 380px; height: 8px; background: #334155; border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--green); width: 0%; transition: 0.4s; }

        .q-card { background: var(--card); color: var(--text); padding: 20px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); margin-top: 5px; }
        
        .audio-btn { background: var(--blue); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; margin-bottom: 10px; box-shadow: 0 4px 10px rgba(0,168,255,0.3); }
        .question-text { font-size: 22px; font-weight: bold; margin-bottom: 15px; color: #2d3436; min-height: 60px; display: flex; align-items: center; justify-content: center; }

        .options-grid { width: 100%; display: flex; flex-direction: column; gap: 8px; }
        .opt-btn { width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e2e8f0; background: white; color: var(--text); font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .opt-btn:hover { background: #f8fafc; }
        .opt-btn.correct { background: var(--green); color: white; border-color: var(--green); }
        .opt-btn.wrong { background: var(--red); color: white; border-color: var(--red); }
        .opt-btn.disabled { opacity: 0.7; cursor: not-allowed; }

        .hidden { display: none !important; }
        
        .mode-badge { background: var(--blue); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin: 5px 0; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="control-btn" onclick="goHome()"><i class="fas fa-home"></i></button>
        <div id="score-display" style="font-weight: bold; color: var(--blue);">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
        <div id="progress-text">1/10</div>
    </div>

    <div class="progress-bar">
        <div id="fill" class="progress-fill"></div>
    </div>

    <div id="mode-badge" class="mode-badge hidden"></div>

    <div id="quiz-content" style="width:100%; display:flex; justify-content:center;">
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø³ÙˆØ§Ù„ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
    </div>

    <!-- ÙØ§ÛŒÙ„ ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ - Ø§Ú¯Ø± Ù†Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ -->
    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ - Ø¨Ø¹Ø¯Ø§Ù‹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± a1-words.js Ù…Ù†ØªÙ‚Ù„ Ú©Ù†ÛŒØ¯
        window.wordsA1 = [
            { word: "apple", translation: "Ø³ÛŒØ¨", definition: "A sweet fruit that is red or green" },
            { word: "book", translation: "Ú©ØªØ§Ø¨", definition: "You read this to learn" },
            { word: "car", translation: "Ù…Ø§Ø´ÛŒÙ†", definition: "A vehicle for transportation" },
            { word: "dog", translation: "Ø³Ú¯", definition: "A common pet animal" },
            { word: "house", translation: "Ø®Ø§Ù†Ù‡", definition: "A place where people live" },
            { word: "water", translation: "Ø¢Ø¨", definition: "Clear liquid for drinking" },
            { word: "school", translation: "Ù…Ø¯Ø±Ø³Ù‡", definition: "Place for education" },
            { word: "friend", translation: "Ø¯ÙˆØ³Øª", definition: "A person you like and trust" },
            { word: "computer", translation: "Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±", definition: "Electronic device for work" },
            { word: "phone", translation: "ØªÙ„ÙÙ†", definition: "Device for communication" },
            { word: "music", translation: "Ù…ÙˆØ³ÛŒÙ‚ÛŒ", definition: "Art of sound and rhythm" },
            { word: "family", translation: "Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡", definition: "Group of related people" },
            { word: "city", translation: "Ø´Ù‡Ø±", definition: "Large human settlement" },
            { word: "country", translation: "Ú©Ø´ÙˆØ±", definition: "Nation with its own government" },
            { word: "time", translation: "Ø²Ù…Ø§Ù†", definition: "Measurable period" }
        ];
    </script>

    <script>
        let session = {
            mode: localStorage.getItem('quizMode') || 'fa-en',
            questions: [],
            index: 0,
            score: 0,
            answered: false
        };

        const MY_TOKEN = "8553224514:AAG0XXzA8da55jCGXnzStP-0IxHhnfkTPRw";
        const MY_CHAT_ID = "96991859";

        // Ù†Ø§Ù… Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†
        const modeNames = {
            'fa-en': 'ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ',
            'en-fa': 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ',
            'word-def': 'Ú©Ù„Ù…Ù‡ Ø¨Ù‡ ØªØ¹Ø±ÛŒÙ',
            'def-word': 'ØªØ¹Ø±ÛŒÙ Ø¨Ù‡ Ú©Ù„Ù…Ù‡',
            'study': 'Ø­Ø§Ù„Øª Ø¢Ù…ÙˆØ²Ø´',
            'review': 'Ù…Ø±ÙˆØ±'
        };

        function goHome() {
            if (confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ù¾ÛŒØ´Ø±ÙØª Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.")) {
                window.location.href = 'index.html';
            }
        }

        function speak(text) {
            if(localStorage.getItem('fredMute') === 'true') return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            msg.rate = 0.8;
            msg.volume = 0.7;
            window.speechSynthesis.speak(msg);
        }

        function render() {
            const q = session.questions[session.index];
            session.answered = false;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
            const progressPercent = ((session.index + 1) / session.questions.length * 100);
            document.getElementById('fill').style.width = `${progressPercent}%`;
            document.getElementById('score-display').innerText = `Ø§Ù…ØªÛŒØ§Ø²: ${session.score}`;
            document.getElementById('progress-text').innerText = `${session.index + 1}/${session.questions.length}`;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ø­Ø§Ù„Øª
            document.getElementById('mode-badge').textContent = modeNames[session.mode] || session.mode;
            document.getElementById('mode-badge').classList.remove('hidden');

            let questionDisplay = "";
            let correctAnswer = "";

            // ØªÙ†Ø¸ÛŒÙ… Ø³ÙˆØ§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆØ¯
            switch(session.mode) {
                case 'fa-en':
                    questionDisplay = q.translation;
                    correctAnswer = q.word;
                    break;
                case 'en-fa':
                    questionDisplay = q.word;
                    correctAnswer = q.translation;
                    break;
                case 'word-def':
                    questionDisplay = q.word;
                    correctAnswer = q.definition;
                    break;
                case 'def-word':
                    questionDisplay = q.definition;
                    correctAnswer = q.word;
                    break;
                default:
                    questionDisplay = q.word;
                    correctAnswer = q.translation;
            }

            // Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØµØ¯Ø§ ÙÙ‚Ø· Ø§Ú¯Ø± Ø®Ø§Ù…ÙˆØ´ Ù†Ø¨Ø§Ø´Ø¯
            if((session.mode === 'en-fa' || session.mode === 'word-def') && 
               localStorage.getItem('fredMute') !== 'true') {
                setTimeout(() => speak(q.word), 500);
            }

            let html = `
                <div class="q-card">
                    <button class="audio-btn" onclick="speak('${q.word}')" title="ØªÙ„ÙØ¸">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <div class="question-text">${questionDisplay}</div>
                    <div class="options-grid" id="options-container">
            `;

            // Ø³Ø§Ø®Øª Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ
            let options = [correctAnswer];
            while(options.length < 4) {
                let randomItem = window.wordsA1[Math.floor(Math.random() * window.wordsA1.length)];
                let randomOption;
                
                switch(session.mode) {
                    case 'fa-en':
                    case 'def-word':
                        randomOption = randomItem.word;
                        break;
                    case 'en-fa':
                        randomOption = randomItem.translation;
                        break;
                    case 'word-def':
                        randomOption = randomItem.definition;
                        break;
                    default:
                        randomOption = randomItem.word;
                }
                
                if(!options.includes(randomOption)) {
                    options.push(randomOption);
                }
            }
            
            // ØªØµØ§Ø¯ÙÛŒâ€ŒØ³Ø§Ø²ÛŒ ØªØ±ØªÛŒØ¨ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
            options.sort(() => Math.random() - 0.5);

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ HTML
            options.forEach((opt, idx) => {
                html += `<button class="opt-btn" onclick="checkAnswer('${opt}', '${correctAnswer}')" data-index="${idx}">${opt}</button>`;
            });

            html += `</div></div>`;
            document.getElementById('quiz-content').innerHTML = html;
        }

        window.checkAnswer = function(selected, correct) {
            if(session.answered) return;
            session.answered = true;
            
            const buttons = document.querySelectorAll('.opt-btn');
            let selectedBtn, correctBtn;
            
            buttons.forEach(btn => {
                if(btn.textContent === selected) selectedBtn = btn;
                if(btn.textContent === correct) correctBtn = btn;
                
                btn.classList.add('disabled');
                btn.onclick = null;
            });
            
            if(selected === correct) {
                session.score++;
                selectedBtn.classList.add('correct');
            } else {
                selectedBtn.classList.add('wrong');
                correctBtn.classList.add('correct');
            }
            
            setTimeout(nextQuestion, 1500);
        }

        function nextQuestion() {
            session.index++;
            if(session.index < session.questions.length) {
                render();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            const finalPercent = Math.round((session.score / session.questions.length) * 100);
            const currentBest = parseInt(localStorage.getItem('fredBest')) || 0;
            
            if(finalPercent > currentBest) {
                localStorage.setItem('fredBest', finalPercent);
            }

            // Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… (Ø¨Ù‡ ØµÙˆØ±Øª ØºÛŒØ±Ù…Ø³Ø¯ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡)
            try {
                const report = `ğŸ“Š Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: ${localStorage.getItem('fredName') || 'Ù…Ù‡Ù…Ø§Ù†'}\nğŸ¯ Ù†Ù…Ø±Ù‡: ${session.score}/${session.questions.length} (${finalPercent}%)\nğŸ›  Ù…ÙˆØ¯: ${modeNames[session.mode] || session.mode}`;
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Image Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ± Ø²Ø¯Ù† CORS
                const img = new Image();
                img.src = `https://api.telegram.org/bot${MY_TOKEN}/sendMessage?chat_id=${MY_CHAT_ID}&text=${encodeURIComponent(report)}`;
            } catch(e) {
                console.log("Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯");
            }

            setTimeout(() => {
                alert(`ğŸ‰ Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯!\n\nØ§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${session.score} Ø§Ø² ${session.questions.length}\nØ¯Ø±ØµØ¯: ${finalPercent}%\n\nØ¨Ù‡ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²: ${Math.max(finalPercent, currentBest)}%`);
                window.location.href = 'index.html';
            }, 500);
        }

        window.onload = () => {
            // Ø§Ù†ØªØ®Ø§Ø¨ Ø³ÙˆØ§Ù„Ø§Øª ØªØµØ§Ø¯ÙÛŒ
            session.questions = [...window.wordsA1]
                .sort(() => Math.random() - 0.5)
                .slice(0, 10);
            
            // Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ ØªÙ… Ø¨Ø§ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
            if(document.body.classList.contains('light-mode')) {
                document.body.classList.add('light-mode');
            }
            
            render();
        };
    </script>
</body>
</html>
