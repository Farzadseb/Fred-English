<script>
/* =========================
   SINGLE, CLEAN APP SCRIPT
   Ø¨Ø¯ÙˆÙ† ØªØ¯Ø§Ø®Ù„ØŒ Ø¨Ø¯ÙˆÙ† ØªÚ©Ø±Ø§Ø±
========================= */

/* ---------- STATE ---------- */
const App = {
    view: 'home',
    mode: null,
    muted: localStorage.getItem('muted') === 'true',
    theme: localStorage.getItem('theme') || 'light',
    bestScore: Number(localStorage.getItem('bestScore') || 0)
};

/* ---------- ELEMENTS ---------- */
const $ = id => document.getElementById(id);

const views = document.querySelectorAll('.view');
const stars = document.querySelectorAll('#starsContainer .star');

/* ---------- VIEW CONTROL ---------- */
function switchView(id) {
    views.forEach(v => v.classList.remove('active'));
    const target = $(id);
    if (target) target.classList.add('active');
    App.view = id;
}

/* ---------- NOTIFICATION ---------- */
function showNotification(msg, time = 2000) {
    const box = $('notification');
    if (!box) return;
    box.textContent = msg;
    box.classList.add('show');
    setTimeout(() => box.classList.remove('show'), time);
}

/* ---------- THEME ---------- */
function applyTheme() {
    document.body.classList.toggle('dark', App.theme === 'dark');
    $('themeBtn').textContent = App.theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
}

function toggleTheme() {
    App.theme = App.theme === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', App.theme);
    applyTheme();
}

/* ---------- MUTE ---------- */
function applyMute() {
    $('muteBtn').textContent = App.muted ? 'ðŸ”‡' : 'ðŸ”Š';
}

function toggleMute() {
    App.muted = !App.muted;
    localStorage.setItem('muted', App.muted);
    applyMute();
    showNotification(App.muted ? 'ØµØ¯Ø§ Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯' : 'ØµØ¯Ø§ Ø±ÙˆØ´Ù† Ø´Ø¯');
}

/* ---------- SCORE ---------- */
function renderScore() {
    $('scoreValue').textContent = App.bestScore + '%';
    const filled = Math.floor(App.bestScore / 20);
    stars.forEach((s, i) => {
        s.classList.toggle('filled', i < filled);
    });
}

function addScore(amount) {
    const newScore = Math.min(100, App.bestScore + amount);
    if (newScore > App.bestScore) {
        App.bestScore = newScore;
        localStorage.setItem('bestScore', App.bestScore);
        renderScore();
    }
}

/* ---------- QUIZ ---------- */
function startQuiz(mode) {
    App.mode = mode;
    switchView('quiz');
    showNotification('Ø¢Ø²Ù…ÙˆÙ† Ø´Ø±ÙˆØ¹ Ø´Ø¯');
}

function backHome() {
    switchView('home');
    App.mode = null;
}

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded', () => {

    applyTheme();
    applyMute();
    renderScore();

    /* theme & mute */
    $('themeBtn')?.addEventListener('click', toggleTheme);
    $('muteBtn')?.addEventListener('click', toggleMute);

    /* mode cards */
    document.querySelectorAll('.mode-card').forEach(card => {
        card.addEventListener('click', () => {
            const mode = card.dataset.mode;
            if (!mode) return;
            startQuiz(mode);
            addScore(5); // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯
        });
    });

    /* buttons */
    $('reviewMistakesBtn')?.addEventListener('click', () => {
        showNotification('Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª');
        addScore(3);
    });

    $('progressReportBtn')?.addEventListener('click', () => {
        showNotification(`Ù¾ÛŒØ´Ø±ÙØª: ${App.bestScore}%`, 3000);
    });

    $('exitBtn')?.addEventListener('click', () => {
        showNotification('Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡');
    });

    /* optional back button */
    $('backToHomeBtn')?.addEventListener('click', backHome);

    console.log('âœ… App loaded cleanly');
});
</script>
