<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b1426; --card: #1e293b; --blue: #00a8ff; --green: #00b894; --purple: #8e44ad; --orange: #e67e22; --red: #d63031; --text: #ffffff; --gray: #94a3b8; }
        body.light-mode { --bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --gray: #64748b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 15px; transition: 0.3s; overflow-x: hidden; }
        
        .top-bar { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .control-btn { background: var(--card); border: none; color: var(--blue); width: 40px; height: 40px; border-radius: 10px; cursor: pointer; }

        .header-box { width: 100%; max-width: 400px; text-align: center; background: var(--card); padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .stars { color: #475569; font-size: 20px; margin-bottom: 5px; }
        .star-active { color: #f1c40f; }
        .score-text { font-size: 14px; color: var(--blue); font-weight: bold; margin-top: 5px; }

        .menu-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 10px; }
        .menu-item { display: flex; align-items: center; padding: 15px 20px; border-radius: 15px; border: none; color: white; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .menu-item i { width: 30px; margin-left: 10px; text-align: center; }
        .menu-item span { flex-grow: 1; text-align: center; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ */
        .options-grid { display: grid; grid-template-columns: 1 white; gap: 10px; width: 100%; margin-top: 20px; }
        .opt-btn { background: var(--card); border: 2px solid var(--blue); color: var(--text); padding: 15px; border-radius: 12px; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .opt-btn:active { background: var(--blue); color: white; }

        .hidden { display: none; }
        .page { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; }
        .q-card { background: var(--card); padding: 20px; border-radius: 20px; width: 100%; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="control-btn" onclick="UI.toggleTheme()"><i id="themeIcon" class="fas fa-moon"></i></button>
        <button class="control-btn" onclick="UI.toggleMute()"><i id="muteIcon" class="fas fa-volume-up"></i></button>
    </div>

    <div id="main-page" class="page">
        <h1>English with Fred</h1>
        <div class="header-box">
            <div class="stars" id="mainStars">
                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
            </div>
            <div class="score-text" id="bestScoreDisplay">Best Score: 0%</div>
            <input type="text" id="userName" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" style="width:80%; padding:10px; margin-top:10px; border-radius:8px; border:1px solid var(--gray); background:var(--bg); color:var(--text); text-align:center;">
            <button onclick="Engine.login()" style="width:85%; padding:10px; margin-top:10px; border-radius:10px; background:var(--blue); color:white; border:none; font-weight:bold;">ÙˆØ±ÙˆØ¯</button>
        </div>

        <div id="menuOptions" class="menu-container hidden">
            <button class="menu-item" style="background:var(--purple)" onclick="Engine.start('study')"><i class="fas fa-graduation-cap"></i><span>Ø¢Ù…ÙˆØ²Ø´ Ù„ØºØ§Øª (Study Mode)</span></button>
            <button class="menu-item" style="background:var(--blue)" onclick="Engine.start('fa-en')"><i class="fas fa-exchange-alt"></i><span>Persian â†’ English (ØªØ³ØªÛŒ)</span></button>
            <button class="menu-item" style="background:var(--green)" onclick="Engine.start('word-def')"><i class="fas fa-book"></i><span>Word â†’ Definition</span></button>
            <button class="menu-item" style="background:var(--dark-green, #006400)" onclick="Engine.start('def-word')"><i class="fas fa-search"></i><span>Definition â†’ Word</span></button>
            <button class="menu-item" style="background:var(--orange)" onclick="Engine.start('review')"><i class="fas fa-sync-alt"></i><span>Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</span></button>
            <button class="menu-item" style="background:var(--red)" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i><span>Ø®Ø±ÙˆØ¬</span></button>
        </div>
    </div>

    <div id="action-page" class="page hidden">
        <div style="width:100%; background:#334155; height:6px; border-radius:10px; margin-bottom:15px;"><div id="progressBar" style="height:100%; background:var(--green); width:0%; transition:0.3s;"></div></div>
        <div id="content-area" style="width:100%;"></div>
    </div>

    <script src="a1-words.js"></script>
    <script>
        const MY_TOKEN = "8553224514:AAG0XXzA8da55jCGXnzStP-0IxHhnfkTPRw";
        const MY_CHAT_ID = "96991859";
        let isMuted = false;
        let session = { mode: '', questions: [], index: 0, score: 0 };

        const UI = {
            toggleTheme() { document.body.classList.toggle('light-mode'); },
            toggleMute() { isMuted = !isMuted; document.getElementById('muteIcon').className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up'; }
        };

        window.onload = () => {
            const best = localStorage.getItem('bestScorePercent') || 0;
            document.getElementById('bestScoreDisplay').innerText = `Best Score: ${best}%`;
            const stars = document.getElementById('mainStars').children;
            const activeStars = Math.floor(best / 20);
            for(let i=0; i<5; i++) stars[i].className = i < activeStars ? "fas fa-star star-active" : "fas fa-star";
            if(localStorage.getItem('fredName')) document.getElementById('userName').value = localStorage.getItem('fredName');
        };

        const Engine = {
            login() {
                const n = document.getElementById('userName').value;
                if(!n) return alert("Ù†Ø§Ù…ØŸ");
                localStorage.setItem('fredName', n);
                document.getElementById('menuOptions').classList.remove('hidden');
            },
            start(mode) {
                session.mode = mode; session.index = 0; session.score = 0;
                session.questions = [...window.wordsA1].sort(() => 0.5 - Math.random()).slice(0, 10);
                document.getElementById('main-page').classList.add('hidden');
                document.getElementById('action-page').classList.remove('hidden');
                this.render();
            },
            render() {
                const q = session.questions[session.index];
                document.getElementById('progressBar').style.width = ((session.index + 1) / 10 * 100) + "%";
                let area = document.getElementById('content-area');
                
                if(session.mode === 'study') {
                    area.innerHTML = `<div class="q-card">
                        <h2 style="font-size:35px; color:var(--blue);">${q.word}</h2>
                        <p style="color:var(--gray)">${q.translation}</p>
                        <div style="text-align:right; background:rgba(0,0,0,0.1); padding:10px; border-radius:10px; margin-bottom:10px;">
                            <small>EXAMPLE:</small><div dir="ltr">${q.ex_en}</div>
                        </div>
                        <button onclick="Engine.next()" style="width:100%; padding:15px; background:var(--blue); color:white; border:none; border-radius:10px; font-weight:bold;">Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù… / Ø¨Ø¹Ø¯ÛŒ</button>
                    </div>`;
                } else {
                    // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
                    let options = [q.word];
                    while(options.length < 4) {
                        let randomWord = window.wordsA1[Math.floor(Math.random()*window.wordsA1.length)].word;
                        if(!options.includes(randomWord)) options.push(randomWord);
                    }
                    options.sort(() => 0.5 - Math.random());

                    area.innerHTML = `<div class="q-card">
                        <h3>Ù…Ø¹Ù†ÛŒ Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ</h3>
                        <h2 style="color:var(--blue)">${q.translation}</h2>
                        <div class="options-grid">
                            ${options.map(opt => `<button class="opt-btn" onclick="Engine.check('${opt}', '${q.word}')">${opt}</button>`).join('')}
                        </div>
                    </div>`;
                }
            },
            check(selected, correct) {
                if(selected === correct) session.score++;
                this.next();
            },
            next() {
                session.index++;
                if(session.index < 10) this.render();
                else this.finish();
            },
            async finish() {
                const percent = (session.score / 10) * 100;
                const prevBest = localStorage.getItem('bestScorePercent') || 0;
                if(percent > prevBest) localStorage.setItem('bestScorePercent', percent);
                
                if(session.mode !== 'study') {
                    const msg = `ðŸ“Š Ú¯Ø²Ø§Ø±Ø´: ${localStorage.getItem('fredName')}\nðŸŽ¯ Ø§Ù…ØªÛŒØ§Ø²: ${percent}%\nðŸ›  Ù…ÙˆØ¯: ${session.mode}`;
                    fetch(`https://api.telegram.org/bot${MY_TOKEN}/sendMessage?chat_id=${MY_CHAT_ID}&text=${encodeURIComponent(msg)}`);
                }
                alert(`Ù¾Ø§ÛŒØ§Ù†. Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${percent}%`);
                location.reload();
            }
        };
    </script>
</body>
</html>
