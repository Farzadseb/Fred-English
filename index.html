<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>English with Fred â€“ A1</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4a90e2">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --blue:#4a90e2;
  --green:#25D366;
  --bg:#f4f7fb;
  --card:rgba(255,255,255,.85);
  --text:#222;
}
[data-theme="dark"]{
  --bg:#0f1115;
  --card:rgba(30,30,30,.85);
  --text:#f1f2f6;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
}
.screen{
  min-height:100vh;
  padding:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.header{
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.icon{
  font-size:20px;
  cursor:pointer;
}
.card{
  width:100%;
  max-width:340px;
  background:var(--card);
  border-radius:22px;
  padding:18px;
  margin:8px 0;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  backdrop-filter: blur(10px);
  text-align:center;
}
.btn{
  width:100%;
  max-width:340px;
  padding:18px;
  border:none;
  border-radius:18px;
  font-size:16px;
  margin:6px 0;
  cursor:pointer;
}
.primary{background:var(--blue);color:white}
.purple{background:#6c5ce7;color:white}
.green{background:var(--green);color:white}

#quiz{display:none}
.qbox{
  margin:30px 0;
  font-size:26px;
  font-weight:900;
}
.opt{
  background:var(--card);
  padding:18px;
  margin:8px 0;
  border-radius:18px;
}
</style>
</head>

<body id="app">

<div id="home" class="screen">
  <div class="header">
    <div class="icon" onclick="toggleTheme()">ğŸŒ“</div>
    <div>English with Fred</div>
    <div class="icon" onclick="toggleMute()">ğŸ”Š</div>
  </div>

  <div class="card">
    â­â­â­â­<br>
    Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²: <span id="best">0</span>%
  </div>

  <button class="btn primary" onclick="start('en-fa')">English â†’ Persian</button>
  <button class="btn primary" onclick="start('fa-en')">Persian â†’ English</button>
  <button class="btn primary" onclick="start('word-def')">Word â†’ Definition</button>
  <button class="btn primary" onclick="start('def-word')">Definition â†’ Word</button>

  <button class="btn purple" onclick="startMistakes()">ğŸ¯ Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</button>

  <a class="btn green" href="https://wa.me/989017708544?text=Ø³Ù„Ø§Ù…ØŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… English with Fred Ù¾ÛŒØ§Ù… Ù…ÛŒâ€ŒØ¯Ù…" target="_blank">
    ğŸ’¬ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± ÙˆØ§ØªØ³Ø§Ù¾
  </a>
</div>

<div id="quiz" class="screen">
  <div class="header">
    <div class="icon" onclick="exitQuiz()">âœ•</div>
    <div id="prog">1/10</div>
    <div class="icon" onclick="speak()">ğŸ”Š</div>
  </div>

  <div id="q" class="card qbox"></div>
  <div id="opts"></div>
</div>

<script src="words.js"></script>
<script>
let db=[],session=[],idx=0,correct=0,mode='',muted=false;
let mistakes=JSON.parse(localStorage.getItem('fred_mistakes')||'[]');

window.onload=()=>{
  db=wordsData.trim().split('\n').map(l=>{
    const [w,fa,def]=l.split(' â€” ');
    return {w,fa,def};
  });
  best.textContent=localStorage.getItem('fred_best')||0;
  if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
};

function start(m){
  mode=m;
  session=[...db].sort(()=>.5-Math.random()).slice(0,10);
  idx=0;correct=0;
  home.style.display='none';
  quiz.style.display='flex';
  render();
}
function startMistakes(){
  if(!mistakes.length) return alert('Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡');
  session=[...mistakes];
  idx=0;correct=0;
  home.style.display='none';
  quiz.style.display='flex';
  render();
}
function render(){
  const q=session[idx];
  prog.textContent=`${idx+1}/${session.length}`;
  let question,answer,pool;
  if(mode==='en-fa'){question=q.w;answer=q.fa;pool=db.map(x=>x.fa)}
  if(mode==='fa-en'){question=q.fa;answer=q.w;pool=db.map(x=>x.w)}
  if(mode==='word-def'){question=q.w;answer=q.def;pool=db.map(x=>x.def)}
  if(mode==='def-word'){question=q.def;answer=q.w;pool=db.map(x=>x.w)}
  q.innerText=question;
  const optsArr=[answer,...pool.filter(x=>x!==answer).sort(()=>.5-Math.random()).slice(0,3)]
    .sort(()=>.5-Math.random());
  opts.innerHTML='';
  optsArr.forEach(o=>{
    const d=document.createElement('div');
    d.className='opt';
    d.innerText=o;
    d.onclick=()=>check(o,answer,q);
    opts.appendChild(d);
  });
  speak();
}
function check(sel,ans,q){
  if(sel===ans){
    correct++;
    mistakes=mistakes.filter(m=>m.w!==q.w);
  }else if(!mistakes.find(m=>m.w===q.w)){
    mistakes.push(q);
  }
  localStorage.setItem('fred_mistakes',JSON.stringify(mistakes));
  setTimeout(()=>{
    idx++;
    idx<session.length?render():finish();
  },400);
}
function finish(){
  const pct=Math.round(correct/session.length*100);
  const best=localStorage.getItem('fred_best')||0;
  if(pct>best) localStorage.setItem('fred_best',pct);
  location.reload();
}
function exitQuiz(){location.reload()}
function toggleTheme(){app.dataset.theme=app.dataset.theme?'':'dark'}
function toggleMute(){muted=!muted}
function speak(){
  if(muted) return;
  const u=new SpeechSynthesisUtterance(q.innerText);
  u.rate=0.5;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}
</script>
</body>
</html>
