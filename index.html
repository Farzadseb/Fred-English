<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b1426; --text: #ffffff; --card: rgba(255,255,255,0.1); --blue: #00a8ff; --wrong: #ff3b30; --gold: #f1c40f; }
        body.light-mode { --bg: #f2f2f7; --text: #1c1c1e; --card: rgba(0,0,0,0.05); }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: env(safe-area-inset-top) 20px 40px; display: flex; flex-direction: column; align-items: center; transition: 0.3s; -webkit-tap-highlight-color: transparent; }
        
        .top { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
        .icon-btn { width: 42px; height: 42px; background: var(--card); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); }

        .main-card { width: 100%; max-width: 380px; background: var(--card); padding: 30px 20px; border-radius: 30px; text-align: center; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø®ÙˆØ´â€ŒØ±Ù†Ú¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… */
        #tg-setup { 
            display: none; margin-top: 20px; padding: 20px; 
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.2), rgba(41, 128, 185, 0.2)); 
            border-radius: 20px; border: 1px solid var(--gold); 
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.2);
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        input { width: 90%; padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: #fff; font-size: 14px; text-align: center; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--gold); }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 15px; font-size: 15px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: #000; margin-top: 10px; }
        .btn-blue { background: var(--blue); color: white; margin-top: 10px; }

        .menu { width: 100%; max-width: 400px; display: none; flex-direction: column; gap: 12px; }
        .menu-item { padding: 18px; border-radius: 20px; color: white; font-weight: 600; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; }

        .mistakes-box { width: 100%; max-width: 380px; background: rgba(255, 59, 48, 0.08); padding: 20px; border-radius: 25px; border: 1px dashed var(--wrong); margin-top: 20px; }
        .mistake-row { background: var(--card); padding: 12px; border-radius: 15px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 4px solid var(--wrong); }
    </style>
</head>
<body>

    <div class="top">
        <div class="icon-btn" onclick="toggleTheme()"><i id="themeIcon" class="fas fa-sun"></i></div>
        <h2 style="font-size: 18px; color: var(--blue); margin:0;">English with Fred</h2>
        <div class="icon-btn" onclick="toggleMute()"><i id="muteIcon" class="fas fa-volume-up"></i></div>
    </div>

    <div id="setup-page" class="main-card" style="display:none">
        <div style="font-size: 40px; color: var(--gold); margin-bottom: 10px;" onclick="secret()">â­</div>
        <h3 style="margin:0">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ Ù‚Ù‡Ø±Ù…Ø§Ù†!</h3>
        <p style="opacity:0.7; font-size: 14px;">Ù†Ø§Ù…Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù† ØªØ§ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…</p>
        
        <input type="text" id="nameInp" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
        <button onclick="saveUser()" class="btn btn-blue">Ø«Ø¨Øª Ùˆ Ø´Ø±ÙˆØ¹</button>

        <div id="tg-setup">
            <i class="fab fa-telegram" style="font-size: 30px; color: #2fb4e9; margin-bottom: 10px;"></i>
            <p style="font-size: 12px; color: var(--gold); margin: 0 0 10px 0;">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø®ØªØµØ§ØµÛŒ Ù…Ø¯Ø±Ø³ (Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ)</p>
            <input type="text" id="token" placeholder="Bot Token">
            <input type="text" id="chatId" placeholder="Chat ID">
            <button onclick="saveTg()" class="btn btn-gold">Ø°Ø®ÛŒØ±Ù‡ Ùˆ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</button>
        </div>
    </div>

    <div id="main-page" class="menu">
        <div class="main-card" style="margin-bottom:10px; padding:20px;">
            <div id="display-stars" style="font-size:25px; color:#f1c40f"></div>
            <div style="font-size:18px; font-weight:bold;" id="hi-user"></div>
            <div id="best-score" style="direction:ltr; font-size:13px; color:var(--blue); margin-top:5px;">Best: 0%</div>
        </div>

        <div class="menu-item" style="background:#8e44ad" onclick="go('study')">ğŸ“š Ø¢Ù…ÙˆØ²Ø´ Ù„ØºØ§Øª Ø¬Ø¯ÛŒØ¯</div>
        <div class="menu-item" style="background:#00a8ff" onclick="go('fa-en')">ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</div>
        <div class="menu-item" style="background:#0984e3" onclick="go('en-fa')">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ</div>
        <div class="menu-item" style="background:#00b894" onclick="go('word-def')">Ù„ØºØª Ø¨Ù‡ Ù…Ø¹Ù†ÛŒ (English)</div>
        
        <div class="mistakes-box">
            <span style="font-weight:bold; color:var(--wrong); font-size:14px;">ğŸ§  Ú©Ù„Ù…Ø§Øª Ú†Ø§Ù„Ø´â€ŒØ¨Ø±Ø§Ù†Ú¯ÛŒØ² Ø´Ù…Ø§</span>
            <div id="m-list">
                <p style="font-size:12px; margin-top:10px; opacity:0.6">Ù‡Ù†ÙˆØ² Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ù†Ø¯Ø§Ø´ØªÙ‡â€ŒØ§ÛŒ. Ø¹Ø§Ù„ÛŒÙ‡!</p>
            </div>
        </div>

        <div class="menu-item" style="background:#25d366; margin-top:10px;" onclick="location.href='https://wa.me/989017708545'">
            <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³â€ŒØ§Ù¾ Ù…Ø¯Ø±Ø³
        </div>
        <button onclick="logout()" style="background:none; border:none; color:var(--wrong); font-size:11px; margin-top:15px; cursor:pointer; opacity: 0.5;">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</button>
    </div>

    <script>
        let taps = 0;
        function id(i) { return document.getElementById(i); }
        
        // Ø¨Ø§ Û³ Ø¨Ø§Ø± Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø³ØªØ§Ø±Ù‡ Ø¨Ø²Ø±Ú¯ØŒ Ù¾Ù†Ù„ Ø·Ù„Ø§ÛŒÛŒ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯
        function secret() { 
            if (++taps === 3) {
                id('tg-setup').style.display = 'block';
                taps = 0;
            }
        }

        function saveTg() {
            localStorage.setItem('tgT', id('token').value);
            localStorage.setItem('tgC', id('chatId').value);
            alert("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! âœ¨");
            id('tg-setup').style.display = 'none';
        }
        
        function toggleTheme() {
            const isL = document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', isL ? 'light' : 'dark');
            id('themeIcon').className = isL ? 'fas fa-moon' : 'fas fa-sun';
        }

        function saveUser() {
            const n = id('nameInp').value.trim();
            if(n) { 
                localStorage.setItem('fredName', n); 
                checkUser(); 
            } else {
                alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù…Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù† Ù‚Ù‡Ø±Ù…Ø§Ù†!");
            }
        }

        function logout() { if(confirm("Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØŸ")) { localStorage.clear(); location.reload(); } }

        function checkUser() {
            const user = localStorage.getItem('fredName');
            if(user) {
                id('setup-page').style.display = 'none';
                id('main-page').style.display = 'flex';
                id('hi-user').innerText = `Ø³Ù„Ø§Ù… ${user} Ø¹Ø²ÛŒØ²`;
                const best = localStorage.getItem('fredBest') || '0';
                id('best-score').innerText = `Best Score: ${best}%`;
                id('display-stars').innerText = 'â­'.repeat(Math.floor(best/20)) + 'â˜†'.repeat(5-Math.floor(best/20));
                renderM();
            } else {
                id('setup-page').style.display = 'block';
            }
        }

        function renderM() {
            const list = JSON.parse(localStorage.getItem('fredM') || '[]');
            if(list.length > 0) {
                id('m-list').innerHTML = list.slice(-3).map(m => `
                    <div class="mistake-row">
                        <div style="text-align:right">
                            <b style="color:var(--blue);direction:ltr;display:block">${m.q}</b>
                            <small>âœ… Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: ${m.a}</small>
                        </div>
                        <i class="fas fa-volume-up" onclick="spk('${m.q}')" style="color:var(--blue); cursor:pointer"></i>
                    </div>
                `).join('');
            }
        }

        function spk(t) { 
            const m = new SpeechSynthesisUtterance(t); 
            m.lang='en-US'; m.rate=0.5; 
            speechSynthesis.speak(m); 
        }

        function go(m) { 
            localStorage.setItem('quizMode', m); 
            location.href = 'quiz.html'; 
        }

        window.onload = () => {
            if(localStorage.getItem('theme')==='light') toggleTheme();
            checkUser();
        };
    </script>
</body>
</html>
