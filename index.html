<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English with Fred</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø¯Ù…ÛŒÙ† */
        .admin-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .admin-content {
            background: #1e293b; padding: 25px; border-radius: 20px;
            width: 85%; max-width: 350px; border: 1px solid #334155;
        }
        .admin-content input {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px;
            border: 1px solid #334155; background: #0f172a; color: white; direction: ltr;
        }
        .btn-save { background: #10b981; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-close { background: #ef4444; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="app-loader" class="loader-overlay">
        <div class="loader-content"><div class="loader"></div><p>Fred is preparing your lesson...</p></div>
    </div>

    <header class="main-header">
        <div class="logo-container" id="admin-trigger" style="cursor: pointer;">
            <h1>English with Fred</h1>
        </div>
    </header>

    <main id="app-container">
        <div id="main-menu" class="menu-container">
            <button class="menu-btn blue" onclick="QuizEngine.start('fa-en')"><i class="fas fa-exchange-alt"></i> Persian â†’ English</button>
            <button class="menu-btn green" onclick="QuizEngine.start('word-def')"><i class="fas fa-book"></i> Word â†’ Definition</button>
            <button class="menu-btn dark-green" onclick="QuizEngine.start('def-word')"><i class="fas fa-search"></i> Definition â†’ Word</button>
            <button class="menu-btn orange" onclick="MistakeManager.showReview()"><i class="fas fa-sync-alt"></i> Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</button>
            <button class="menu-btn red" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬ / ØªØºÛŒÛŒØ± Ú©Ø§Ø±Ø¨Ø±</button>
        </div>
    </main>

    <div id="adminModal" class="admin-modal">
        <div class="admin-content">
            <h3 style="text-align: center; margin-bottom: 15px;">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…</h3>
            <input type="text" id="botToken" placeholder="Bot Token (Ù…Ø«Ø§Ù„: 12345:ABC...)">
            <input type="text" id="chatId" placeholder="Chat ID (Ù…Ø«Ø§Ù„: 98765432)">
            <button class="btn-save" onclick="saveSettings()">Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            <button class="btn-close" onclick="toggleAdmin(false)">Ø¨Ø³ØªÙ†</button>
        </div>
    </div>

    <div id="notification-container"></div>

    <script>
        // Û±. Ø¯ÛŒØªØ§ÛŒ Ú©Ù„Ù…Ø§Øª (Ø¨Ø±Ø§ÛŒ ØªØ³Øª)
        window.words = [
            { id: 1, word: "Ability", translation: "ØªÙˆØ§Ù†Ø§ÛŒÛŒ", definition: "The power or skill to do something", collocation: "Great ability", example: "He has the ability to learn quickly." }
        ];

        // Û². Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª (Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø´Ù…Ø§)
        let clickCount = 0;
        document.getElementById('admin-trigger').onclick = () => {
            clickCount++;
            if (clickCount >= 3) {
                toggleAdmin(true);
                clickCount = 0;
            }
            setTimeout(() => clickCount = 0, 2000);
        };

        function toggleAdmin(show) {
            const modal = document.getElementById('adminModal');
            modal.style.display = show ? 'flex' : 'none';
            if (show) {
                document.getElementById('botToken').value = localStorage.getItem('fred_bot_token') || '';
                document.getElementById('chatId').value = localStorage.getItem('fred_chat_id') || '';
            }
        }

        function saveSettings() {
            const token = document.getElementById('botToken').value.trim();
            const id = document.getElementById('chatId').value.trim();
            if (token && id) {
                localStorage.setItem('fred_bot_token', token);
                localStorage.setItem('fred_chat_id', id);
                alert('âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
                toggleAdmin(false);
            } else {
                alert('âŒ Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ Ù…ÙˆØ±Ø¯ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.');
            }
        }

        // Û³. Ù…ÙˆØªÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        const TelegramReporter = {
            async sendResult(score, total) {
                const token = localStorage.getItem('fred_bot_token');
                const chatId = localStorage.getItem('fred_chat_id');
                if (!token || !chatId) return;

                const message = `ğŸ“Š *Ú¯Ø²Ø§Ø±Ø´ Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯*\n\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÙØ±Ø²Ø§Ø¯\nâœ… Ù†Ù…Ø±Ù‡: ${score} Ø§Ø² ${total}\nğŸ“ˆ Ø¯Ø±ØµØ¯: ${Math.round((score/total)*100)}%`;
                
                try {
                    await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'Markdown' })
                    });
                } catch (e) { console.error("Telegram Error:", e); }
            }
        };

        // Û´. Ù…ÙˆØªÙˆØ± Ø¢Ø²Ù…ÙˆÙ† (QuizEngine)
        const QuizEngine = {
            currentIndex: 0, score: 0, totalQuestions: 1,
            start(mode) {
                this.currentIndex = 0; this.score = 0;
                this.nextQuestion();
            },
            nextQuestion() {
                const container = document.getElementById('app-container');
                if (this.currentIndex >= this.totalQuestions) {
                    this.finish(); return;
                }
                const word = window.words[0]; // ÙØ¹Ù„Ø§Ù‹ Ø±ÙˆÛŒ Ú©Ù„Ù…Ù‡ Ø§ÙˆÙ„ Ø«Ø§Ø¨Øª
                container.innerHTML = `
                    <div class="quiz-card animate-in">
                        <h2>${word.word}</h2>
                        <div class="choices-grid">
                            <button class="choice-btn" onclick="QuizEngine.check(true)">${word.translation}</button>
                            <button class="choice-btn" onclick="QuizEngine.check(false)">Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡</button>
                        </div>
                    </div>`;
            },
            check(isCorrect) {
                if(isCorrect) this.score++;
                this.currentIndex++;
                this.nextQuestion();
            },
            finish() {
                document.getElementById('app-container').innerHTML = `<div class="quiz-card" style="text-align:center;"><h2>Ø¢Ø²Ù…ÙˆÙ† ØªÙ…Ø§Ù… Ø´Ø¯</h2><button class="menu-btn blue" onclick="location.reload()">Ø¨Ø§Ø²Ú¯Ø´Øª</button></div>`;
                TelegramReporter.sendResult(this.score, this.totalQuestions);
            }
        };

        window.onload = () => { document.getElementById('app-loader').style.display = 'none'; };
    </script>
</body>
</html>
