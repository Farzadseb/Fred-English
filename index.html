<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English with Fred</title>
    <style>
        :root { --ios-blue: #007AFF; --ios-bg: #F2F2F7; }
        body { font-family: -apple-system, sans-serif; background: var(--ios-bg); margin: 0; padding: 20px; text-align: center; }
        .screen { display: flex; flex-direction: column; align-items: center; background: #fff; border-radius: 30px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-top: 20px; }
        .header-title { font-size: 24px; font-weight: 800; margin-bottom: 10px; cursor: pointer; }
        .btn-main { background: var(--ios-blue); color: white; border: none; padding: 15px; border-radius: 15px; width: 100%; font-size: 17px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .mode-selector { width: 100%; margin: 20px 0; }
        .btn-mode { background: #f9f9f9; border: 1px solid #ddd; padding: 12px; border-radius: 12px; margin-bottom: 8px; width: 100%; text-align: right; font-weight: 600; cursor: pointer; }
        .active { border: 2px solid var(--ios-blue); color: var(--ios-blue); }
        #adminPanel { display: none; width: 100%; }
        textarea { width: 100%; height: 100px; border-radius: 10px; padding: 10px; margin-bottom: 10px; direction: ltr; }
        .q-text { font-size: 2rem; font-weight: 800; margin: 40px 0; direction: ltr; unicode-bidi: plaintext; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; }
        .btn-opt { padding: 15px; border-radius: 15px; border: 1px solid #ddd; background: #fff; font-size: 16px; font-weight: 600; }
        .correct { background: #34C759 !important; color: white; }
        .wrong { background: #FF3B30 !important; color: white; }
    </style>
</head>
<body>
    <div id="setup" class="screen">
        <h1 class="header-title" onclick="adminClick()">English with Fred</h1>
        <div id="bestRecord" style="font-size: 13px; color: #666; margin-bottom: 10px;">Best: 0%</div>
        <div id="adminPanel">
            <textarea id="bulkInput" oninput="saveRawData()"></textarea>
            <button onclick="document.getElementById('adminPanel').style.display='none'" class="btn-main" style="background:#ccc;">Ø¨Ø³ØªÙ†</button>
        </div>
        <div class="mode-selector">
            <button class="btn-mode active" onclick="setMode(1, this)">Û±. Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ</button>
            <button class="btn-mode" onclick="setMode(2, this)">Û². ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</button>
        </div>
        <button class="btn-main" onclick="startQuiz()">ğŸš€ Ø´Ø±ÙˆØ¹ Ú©ÙˆÛŒÛŒØ²</button>
    </div>
    <div id="quiz" class="screen" style="display: none;">
        <div id="qDisplay" class="q-text"></div>
        <div class="options-grid" id="opts"></div>
    </div>
    <script>
        const phone = "989017708544";
        const defaultWords = `be â€” Ø¨ÙˆØ¯Ù† â€” To live or to stay.\nam â€” Ù‡Ø³ØªÙ… â€” I ___ (Used with I).\nis â€” Ù‡Ø³Øª â€” He/She/It ___ (Used with one).\nare â€” Ù‡Ø³ØªÛŒØ¯ â€” You/We/They ___ (Used with many).`;
        let db = [], session = [], idx = 0, currentMode = 1;
        window.onload = () => { document.getElementById('bulkInput').value = localStorage.getItem('fred_final_data') || defaultWords; };
        function adminClick() { let p = prompt("Password:"); if (p === "134212") document.getElementById('adminPanel').style.display = 'block'; }
        function setMode(m, el) { currentMode = m; document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
        function saveRawData() { localStorage.setItem('fred_final_data', document.getElementById('bulkInput').value); }
        function startQuiz() {
            let raw = document.getElementById('bulkInput').value.trim().split('\n');
            db = raw.map(l => { let p = l.split(' â€” '); return p.length >= 2 ? { en: p[0].trim(), fa: p[1].trim(), def: p[2] || "Basic" } : null; }).filter(x => x);
            session = [...db].sort(() => 0.5 - Math.random());
            idx = 0; document.getElementById('setup').style.display = 'none'; document.getElementById('quiz').style.display = 'flex'; render();
        }
        function render() {
            const q = session[idx]; let ans = currentMode === 1 ? q.fa : q.en;
            document.getElementById('qDisplay').textContent = currentMode === 1 ? q.en : q.fa;
            let opts = [ans]; let pool = db.map(v => currentMode === 1 ? v.fa : v.en).filter(v => v !== ans);
            while(opts.length < 4 && pool.length) { let r = pool.splice(Math.floor(Math.random()*pool.length), 1)[0]; if(!opts.includes(r)) opts.push(r); }
            opts.sort(() => 0.5 - Math.random());
            const div = document.getElementById('opts'); div.innerHTML = '';
            opts.forEach(o => {
                const b = document.createElement('button'); b.className = 'btn-opt'; b.textContent = o;
                b.onclick = () => {
                    if(o === ans) { b.classList.add('correct'); setTimeout(() => { idx++; if(idx < session.length) render(); else location.reload(); }, 1000); }
                    else { b.classList.add('wrong'); }
                };
                div.appendChild(b);
            });
        }
    </script>
</body>
</html>
