<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English with Fred Elite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-grad: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            --glass-bg: rgba(255, 255, 255, 0.92);
            --glass-border: rgba(255, 255, 255, 0.6);
            --text-main: #2d3436;
            --primary-blue: #4a90e2;
            --soft-indigo: #6c5ce7;
        }
        [data-theme="dark"] {
            --bg-grad: linear-gradient(135deg, #1e272e 0%, #050505 100%);
            --glass-bg: rgba(30, 39, 46, 0.98);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #f1f2f6;
            --primary-blue: #54a0ff;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-grad);
            margin: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px;
        }
        .screen {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            width: 100%; max-width: 400px; min-height: 620px; border-radius: 40px; padding: 25px;
            border: 1px solid var(--glass-border); box-shadow: 0 15px 35px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; position: relative;
        }
        .header-nav { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .top-icon { font-size: 22px; cursor: pointer; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; color: var(--text-main); }
        .header-title { font-size: 22px; font-weight: 850; color: var(--text-main); margin: 0; cursor: pointer; user-select: none; }
        .btn-mode {
            background: #fff; border: 1.5px solid #eee; padding: 16px; border-radius: 18px;
            width: 100%; margin-bottom: 10px; font-weight: 600; cursor: pointer; color: var(--text-main); text-align: center;
        }
        .btn-mode.active { border-color: var(--primary-blue); color: var(--primary-blue); background: rgba(74, 144, 226, 0.05); }
        .en-text { direction: ltr !important; text-align: left !important; display: block; width: 100%; padding-left: 15px; }
        .btn-action {
            border: none; color: white; font-weight: 700; width: 100%; padding: 18px;
            border-radius: 20px; font-size: 17px; cursor: pointer; background: var(--primary-blue); margin-top: 10px;
        }
        .btn-disabled { background: #ccc !important; cursor: not-allowed; opacity: 0.7; }
        .footer-contact {
            margin-top: auto; padding-top: 20px; display: flex; flex-direction: column; align-items: center; border-top: 1px solid rgba(0,0,0,0.05);
        }
        .whatsapp-link {
            text-decoration: none; color: #25D366; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 14px;
            background: rgba(37, 211, 102, 0.1); padding: 10px 20px; border-radius: 50px;
        }
        .q-text { font-size: 1.6rem; font-weight: 800; color: var(--text-main); direction: ltr; text-align: center; margin: 30px 0; }
        .correct { border-color: #55efc4 !important; color: #00b894 !important; }
        .wrong { border-color: #ff7675 !important; color: #d63031 !important; }
        #usageLimit { font-size: 12px; color: #e74c3c; margin-top: 5px; display: none; text-align: center; font-weight: bold; }
        #versionTag { font-size: 10px; color: var(--primary-blue); opacity: 0.4; margin-bottom: 5px; text-align: center; }
    </style>
</head>
<body>

    <div id="setup" class="screen">
        <div class="header-nav">
            <div class="top-icon" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            <h1 class="header-title" onclick="masterTrigger()">English with Fred</h1>
            <div id="mainMuteBtn" class="top-icon" onclick="toggleMute()"><i class="fas fa-volume-up"></i></div>
        </div>
        
        <div id="versionTag">Standard Version</div>

        <div id="modeList">
            <div class="btn-mode active" onclick="setMode(1, this)">Û±. Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ</div>
            <div class="btn-mode" onclick="setMode(2, this)">Û². ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</div>
            <div class="btn-mode" onclick="setMode(3, this)">Û³. Ù„ØºØª Ø¨Ù‡ ØªØ¹Ø±ÛŒÙ</div>
            <div class="btn-mode" onclick="setMode(4, this)">Û´. ØªØ¹Ø±ÛŒÙ Ø¨Ù‡ Ù„ØºØª</div>
        </div>

        <button id="startBtn" class="btn-action" onclick="startQuiz(false)" style="margin-top: 20px;">ğŸš€ Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯</button>
        <p id="usageLimit">âŒ Ø³Ù‡Ù…ÛŒÙ‡ ØªÙ…Ø±ÛŒÙ† Ø±Ø§ÛŒÚ¯Ø§Ù† (Û±Û° Ø¨Ø§Ø± Ø¯Ø± Ø±ÙˆØ²) ØªÙ…Ø§Ù… Ø´Ø¯.</p>
        
        <button class="btn-action" style="background: var(--soft-indigo);" onclick="startQuiz(true)">ğŸ¯ Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</button>

        <div class="footer-contact">
            <a id="waLink" href="#" target="_blank" class="whatsapp-link">
                <i class="fab fa-whatsapp" style="font-size: 20px;"></i>
                <span>Ù…Ø´Ø§ÙˆØ±Ù‡ Ùˆ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù„Ø§Ø³ (Fred)</span>
            </a>
        </div>
    </div>

    <div id="quiz" class="screen" style="display: none;">
        <div class="header-nav">
            <div class="top-icon" onclick="say()"><i class="fas fa-volume-up"></i></div>
            <div style="font-weight: 800; color: var(--text-main);" id="progressText">1 / 20</div>
            <div class="top-icon" onclick="location.reload()"><i class="fas fa-times"></i></div>
        </div>
        <div id="qDisplay" class="q-text"></div>
        <div id="opts"></div>
    </div>

    <script src="dic.js"></script>
    <script>
        // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø®ØªØµØ§ØµÛŒ Ø§Ø³ØªØ§Ø¯ Fred ---
        const myPhone = "989120000000"; // Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ
        const masterPass = "Fred77"; // Ø±Ù…Ø²ÛŒ Ú©Ù‡ ÙÙ‚Ø· Ø®ÙˆØ¯ØªØ§Ù† Ù…ÛŒâ€ŒØ¯Ø§Ù†ÛŒØ¯
        // ---------------------------------

        const messageText = "Ø³Ù„Ø§Ù… Ø§Ø³ØªØ§Ø¯ Fred Ø¹Ø²ÛŒØ²ØŒ Ù…Ù† Ù…ÛŒâ€ŒØ®ÙˆØ§Ø³ØªÙ… Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Ø¯Ø± Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø´Ø±Ú©Øª Ú©Ù†Ù…. Ù„Ø·ÙØ§Ù‹ Ù…Ù† Ø±Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ú©Ù†ÛŒØ¯.";
        document.getElementById('waLink').href = `https://wa.me/${myPhone}?text=${encodeURIComponent(messageText)}`;

        let isMaster = localStorage.getItem('device_token_status') === 'premium_active';
        let clickCount = 0;

        function checkUsage() {
            if (isMaster) {
                document.getElementById('versionTag').textContent = "â˜… Premium Version (Unlimited) â˜…";
                document.getElementById('versionTag').style.opacity = "1";
                return true;
            }
            const today = new Date().toDateString();
            let usage = JSON.parse(localStorage.getItem('daily_usage')) || { date: today, count: 0 };
            if (usage.date !== today) usage = { date: today, count: 0 };
            
            if (usage.count >= 10) {
                const btn = document.getElementById('startBtn');
                btn.classList.add('btn-disabled');
                btn.onclick = null;
                document.getElementById('usageLimit').style.display = 'block';
                return false;
            }
            return true;
        }

        function incrementUsage() {
            if (isMaster) return;
            const today = new Date().toDateString();
            let usage = JSON.parse(localStorage.getItem('daily_usage')) || { date: today, count: 0 };
            usage.count++;
            localStorage.setItem('daily_usage', JSON.stringify(usage));
            checkUsage();
        }

        function masterTrigger() {
            clickCount++;
            if (clickCount >= 3) {
                const pass = prompt("Ú©Ø¯ ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ù†Ø³Ø®Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
                if (pass === masterPass) {
                    isMaster = true;
                    localStorage.setItem('device_token_status', 'premium_active');
                    alert("Ø§ÛŒÙ† Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ø·Ù„Ø§ÛŒÛŒ Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØª.");
                    location.reload();
                }
                clickCount = 0;
            }
        }

        window.onload = checkUsage;

        // Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø¢Ø²Ù…ÙˆÙ† (Ù‡Ù…Ø§Ù† Ú©Ø¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ø§ØµÙ„Ø§Ø­Ø§Øª Ø¬Ø²ÛŒÛŒ)
        let db = [], session = [], idx = 0, currentMode = 1, busy = false, isMuted = false;
        let mistakeBank = JSON.parse(localStorage.getItem('fred_mistakes_v4')) || [];

        function toggleTheme() { document.body.toggleAttribute('data-theme'); }
        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('mainMuteBtn').innerHTML = isMuted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
            if(isMuted) window.speechSynthesis.cancel();
        }

        function setMode(m, el) { 
            currentMode = m; 
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active')); 
            el.classList.add('active'); 
        }

        function startQuiz(fromMistakes) {
            if (!fromMistakes && !checkUsage()) return;
            if (!fromMistakes) incrementUsage();
            let source = fromMistakes ? mistakeBank : (typeof permanentWords !== 'undefined' ? permanentWords.trim().split('\n') : []);
            if(fromMistakes && mistakeBank.length === 0) return alert("Ù„ÛŒØ³Øª Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!");
            db = source.map(l => {
                let p = l.split(' â€” ');
                return p.length >= 2 ? { en: p[0].trim(), fa: p[1].trim(), def: p[2] ? p[2].trim() : "Definition" } : null;
            }).filter(x => x);
            session = [...db].sort(() => 0.5 - Math.random()).slice(0, 20);
            document.getElementById('setup').style.display = 'none';
            document.getElementById('quiz').style.display = 'flex';
            idx = 0; render();
        }

        function render() {
            busy = false; const q = session[idx]; let qText = "", ans = "";
            document.getElementById('progressText').textContent = `${idx + 1} / ${session.length}`;
            if(currentMode === 1) { qText = q.en; ans = q.fa; }
            else if(currentMode === 2) { qText = q.fa; ans = q.en; }
            else if(currentMode === 3) { qText = q.en; ans = q.def; }
            else { qText = q.def; ans = q.en; }
            document.getElementById('qDisplay').textContent = qText;
            const div = document.getElementById('opts');
            div.innerHTML = '';
            let opts = [ans];
            let pool = db.filter(v => v.en !== q.en).map(v => {
                if(currentMode === 1) return v.fa; if(currentMode === 2) return v.en;
                if(currentMode === 3) return v.def; return v.en;
            });
            while(opts.length < 4 && pool.length) {
                let r = pool.splice(Math.floor(Math.random()*pool.length), 1)[0];
                if(!opts.includes(r)) opts.push(r);
            }
            opts.sort(() => 0.5 - Math.random());
            opts.forEach(o => {
                const b = document.createElement('button');
                b.className = 'btn-mode';
                if(currentMode !== 1) b.classList.add('en-text');
                b.textContent = o;
                b.onclick = () => {
                    if(busy) return; busy = true;
                    if(o === ans) b.classList.add('correct');
                    else {
                        b.classList.add('wrong');
                        if(!mistakeBank.some(m => m.en === q.en)) {
                            mistakeBank.push(q);
                            localStorage.setItem('fred_mistakes_v4', JSON.stringify(mistakeBank));
                        }
                        div.querySelectorAll('button').forEach(btn => { if(btn.textContent === ans) btn.classList.add('correct'); });
                    }
                    setTimeout(() => { idx++; if(idx < session.length) render(); else location.reload(); }, 1200);
                };
                div.appendChild(b);
            });
            say(); 
        }

        function say() {
            if (!session[idx] || isMuted || currentMode === 2) return;
            window.speechSynthesis.cancel(); 
            const u = new SpeechSynthesisUtterance(currentMode === 4 ? session[idx].def : session[idx].en);
            u.lang = 'en-US'; u.rate = 0.7;
            window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>
