<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --ios-blue: #4a90e2; 
            --ios-indigo: #6c5ce7; 
            --ios-green: #25D366; 
            --ios-red: #FF3B30; 
            --bg-page: #f0f7ff; /* Ø¢Ø¨ÛŒ Ø¨Ø³ÛŒØ§Ø± Ù…Ù„Ø§ÛŒÙ… Ùˆ Ù„Ø·ÛŒÙ */
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-page); margin: 0; height: 100vh; overflow: hidden; position: fixed; width: 100%; padding-top: env(safe-area-inset-top); }
        
        .screen { height: 100%; display: flex; flex-direction: column; padding: 25px; align-items: center; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        
        .header-nav { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .header-title { color: #2d3436; font-size: 24px; font-weight: 850; cursor: pointer; user-select: none; margin: 0; }
        .top-icon { font-size: 22px; cursor: pointer; color: #2d3436; width: 40px; text-align: center; }

        .daily-goal-box { background: #fff; width: 100%; border-radius: 25px; padding: 15px; margin-bottom: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .goal-stars { font-size: 24px; margin: 5px 0; color: #dfe6e9; letter-spacing: 3px; }
        .goal-stars .active { color: #f1c40f; }
        .goal-text { font-size: 13px; color: #2d3436; font-weight: 800; margin-top: 5px; }

        .record-badge { background: rgba(108, 92, 231, 0.1); padding: 8px 18px; border-radius: 20px; font-size: 13px; color: var(--ios-indigo); font-weight: 900; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        
        .mode-selector { width: 100%; display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-mode { background: #fff; border: 1.5px solid #eee; padding: 16px; border-radius: 18px; text-align: center; font-weight: 600; font-size: 15px; color: #2d3436; }
        .btn-mode.active { border: 2px solid var(--ios-blue); color: var(--ios-blue); background: rgba(74, 144, 226, 0.05); }

        .btn-main { border: none; color: white; font-weight: 700; width: 100%; padding: 18px; border-radius: 22px; margin-bottom: 12px; font-size: 17px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); cursor: pointer; }
        
        .footer-contact { margin-top: auto; padding-bottom: 40px; width: 100%; }
        .whatsapp-btn { background: var(--ios-green); color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 16px; border-radius: 50px; font-weight: bold; font-size: 15px; }

        .q-text { font-size: 2rem; font-weight: 800; margin: 40px 0; text-align: center; color: #2d3436; }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; width: 100%; }
        .btn-opt { padding: 18px; border-radius: 18px; border: 1.5px solid #eee; background: #fff; font-size: 16px; font-weight: 600; text-align: center; }
        .correct { background: var(--ios-green) !important; color: white !important; }
        .wrong { background: var(--ios-red) !important; color: white !important; }
        .exit-btn { position: absolute; top: 20px; left: 20px; background: #eee; border: none; width: 35px; height: 35px; border-radius: 50%; font-weight: bold; }
        
        #adminPanel { display: none; width: 100%; background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #ddd; }
        textarea { width: 100%; min-height: 100px; border-radius: 10px; border: 1px solid #ccc; padding: 10px; font-size: 12px; direction: ltr; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="setup" class="screen">
        <div class="header-nav">
            <div class="top-icon">ğŸŒ“</div>
            <h1 class="header-title" onclick="adminClick()">English with Fred</h1>
            <div id="muteBtn" class="top-icon" onclick="toggleMute()">ğŸ”Š</div>
        </div>
        
        <div class="daily-goal-box">
            <div id="goalStars" class="goal-stars">â˜†â˜†â˜†â˜†</div>
            <div id="goalMsg" class="goal-text">Best Score: <span id="highScoreDisp">0</span>%</div>
        </div>

        <div id="bestRecord" class="record-badge">Best Record: 0%</div>

        <div id="adminPanel">
            <textarea id="bulkInput" oninput="saveRawData()"></textarea>
            <button onclick="document.getElementById('adminPanel').style.display='none'" style="width:100%; padding:8px; border:none; background:#eee; border-radius:8px;">Save</button>
        </div>

        <div class="mode-selector">
            <div class="btn-mode active" onclick="setMode(1, this)">Û±. Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ</div>
            <div class="btn-mode" onclick="setMode(2, this)">Û². ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</div>
            <div class="btn-mode" onclick="setMode(3, this)">Û³. Ù„ØºØª Ø¨Ù‡ ØªØ¹Ø±ÛŒÙ (A1)</div>
            <div class="btn-mode" onclick="setMode(4, this)">Û´. ØªØ¹Ø±ÛŒÙ Ø¨Ù‡ Ù„ØºØª (A1)</div>
        </div>

        <button class="btn-main" style="background:var(--ios-blue)" onclick="startQuiz(false)">ğŸš€ Ø´Ø±ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯</button>
        <button class="btn-main" style="background:var(--ios-indigo)" onclick="openMistakePage()">ğŸ¯ Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</button>

        <div class="footer-contact">
            <a href="https://wa.me/989017708544" class="whatsapp-btn">
                <i class="fab fa-whatsapp" style="font-size: 20px;"></i>
                <span>Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Fred: 09017708544</span>
            </a>
        </div>
    </div>

    <div id="quiz" class="screen" style="display: none; background: #fff;">
        <button class="exit-btn" onclick="location.reload()">âœ•</button>
        <div id="qDisplay" class="q-text"></div>
        <div id="audioBtn" style="font-size: 3rem; margin-bottom: 20px; cursor: pointer;" onclick="say()">ğŸ”Š</div>
        <div class="options-grid" id="opts"></div>
    </div>

    <div id="mistakePage" class="screen" style="display:none;">
        <button class="exit-btn" onclick="location.reload()">âœ•</button>
        <h2 style="margin-top: 50px;">Ù„ØºØ§Øª Ø¯Ø´ÙˆØ§Ø±</h2>
        <div id="mList" style="width: 100%;"></div>
    </div>

    <script>
        // Ø¯ÛŒØªØ§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø´Ù…Ø§ (Ø®Ù„Ø§ØµÙ‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ¶Ø§ - Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø±Ø§ Ø¯Ø± Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø±ÛŒØ²ÛŒØ¯)
        const defaultWords = `be â€” Ø¨ÙˆØ¯Ù† â€” To live or to stay.\nhave â€” Ø¯Ø§Ø´ØªÙ† â€” To own this.\ndo â€” Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù† â€” To work.`;

        let db = [], session = [], idx = 0, busy = false, currentMode = 1, isMuted = false;
        let score = { correct: 0 };
        let mistakeBank = JSON.parse(localStorage.getItem('fred_final_mistakes')) || [];
        let clickCount = 0;

        window.onload = () => {
            document.getElementById('bulkInput').value = localStorage.getItem('fred_final_data') || defaultWords;
            updateDisplay();
        };

        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('muteBtn').textContent = isMuted ? "ğŸ”‡" : "ğŸ”Š";
        }

        function adminClick() {
            clickCount++;
            if (clickCount >= 3) {
                if (prompt("Pass:") === "134212") document.getElementById('adminPanel').style.display = 'block';
                clickCount = 0;
            }
        }

        function updateDisplay() {
            const best = localStorage.getItem('fred_best_score') || 0;
            document.getElementById('bestRecord').textContent = `Best Record: ${best}%`;
            document.getElementById('highScoreDisp').textContent = best;
            
            // Ù†Ù…Ø§ÛŒØ´ Û´ Ø³ØªØ§Ø±Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù…ØªÛŒØ§Ø² (Ù‡Ø± Û²Ûµ Ø¯Ø±ØµØ¯ ÛŒÚ© Ø³ØªØ§Ø±Ù‡)
            let stars = "";
            let starCount = Math.floor(best / 25);
            for(let i=1; i<=4; i++) {
                stars += `<span class="${i <= starCount ? 'active' : ''}">â˜…</span>`;
            }
            document.getElementById('goalStars').innerHTML = stars;
        }

        function setMode(m, el) {
            currentMode = m;
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function saveRawData() { localStorage.setItem('fred_final_data', document.getElementById('bulkInput').value); }

        function startQuiz(fromMistakes) {
            let raw = fromMistakes ? mistakeBank : document.getElementById('bulkInput').value.trim().split('\n');
            db = raw.map(l => {
                let p = l.split(/[â€”\-:]+/);
                return p.length >= 2 ? { en: p[0].trim(), fa: p[1].trim(), def: p[2] ? p[2].trim() : "Basic" } : null;
            }).filter(x => x);

            session = [...db].sort(() => 0.5 - Math.random()).slice(0, 20);
            score.correct = 0; idx = 0;
            document.getElementById('setup').style.display = 'none';
            document.getElementById('quiz').style.display = 'flex';
            render();
        }

        function render() {
            busy = false; const q = session[idx]; let qText = "", ans = "";
            if(currentMode === 1) { qText = q.en; ans = q.fa; }
            else if(currentMode === 2) { qText = q.fa; ans = q.en; }
            else if(currentMode === 3) { qText = q.en; ans = q.def; }
            else { qText = q.def; ans = q.en; }
            document.getElementById('qDisplay').textContent = qText;
            document.getElementById('audioBtn').style.display = (currentMode === 1 || currentMode === 3) ? 'block' : 'none';
            let opts = [ans], pool = db.filter(v => v.en !== q.en).map(v => (currentMode==1?v.fa:(currentMode==3?v.def:v.en)));
            while(opts.length < 4) opts.push(pool.splice(Math.floor(Math.random()*pool.length), 1)[0]);
            opts.sort(() => 0.5 - Math.random());
            const div = document.getElementById('opts'); div.innerHTML = '';
            opts.forEach(o => {
                const b = document.createElement('button');
                b.className = 'btn-opt'; b.textContent = o;
                b.onclick = () => {
                    if(busy) return; busy = true;
                    if(o === ans) { b.classList.add('correct'); score.correct++; }
                    else {
                        b.classList.add('wrong');
                        if(!mistakeBank.some(m => m.en === q.en)) {
                            mistakeBank.push(q);
                            localStorage.setItem('fred_final_mistakes', JSON.stringify(mistakeBank));
                        }
                    }
                    setTimeout(() => { 
                        idx++; 
                        if(idx < session.length) render(); 
                        else {
                            let finalPct = Math.round((score.correct / session.length) * 100);
                            if(finalPct > (localStorage.getItem('fred_best_score') || 0)) localStorage.setItem('fred_best_score', finalPct);
                            location.reload();
                        }
                    }, 1000);
                };
                div.appendChild(b);
            });
            if(!isMuted && (currentMode === 1 || currentMode === 3)) say();
        }

        function openMistakePage() {
            document.getElementById('setup').style.display = 'none';
            document.getElementById('mistakePage').style.display = 'flex';
            const list = document.getElementById('mList');
            list.innerHTML = mistakeBank.length ? '' : '<p>No mistakes!</p>';
            mistakeBank.forEach((m, i) => {
                const d = document.createElement('div');
                d.style = "background:#fff; padding:15px; border-radius:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #ddd; width:100%;";
                d.innerHTML = `<span style="direction:ltr;">${m.en}</span><span onclick="removeM(${i})" style="color:var(--ios-red); cursor:pointer;">âœ•</span>`;
                list.appendChild(d);
            });
        }
        function removeM(i) { mistakeBank.splice(i, 1); localStorage.setItem('fred_final_mistakes', JSON.stringify(mistakeBank)); openMistakePage(); }
        function say() { if(isMuted) return; const u = new SpeechSynthesisUtterance(session[idx].en); u.lang = 'en-US'; window.speechSynthesis.speak(u); }
    </script>
</body>
</html>
