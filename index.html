<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English with Fred</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0b1426; --card: #1e293b; --blue: #00a8ff; --green: #00b894; --purple: #8e44ad; --orange: #e67e22; --red: #d63031; --text: #ffffff; --gray: #94a3b8; }
        body.light-mode { --bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --gray: #64748b; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 15px; transition: 0.3s; }
        .top-bar { width: 100%; max-width: 400px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; margin-top: 10px; }
        .control-btn { background: var(--card); border: none; color: var(--blue); width: 45px; height: 45px; border-radius: 12px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .header-box { width: 100%; max-width: 400px; text-align: center; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-bottom: 20px; }
        input { width: 85%; padding: 12px; border-radius: 10px; border: 1px solid var(--gray); background: var(--bg); color: var(--text); text-align: center; margin-top: 10px; outline: none; font-size: 16px; }
        .stars { color: #475569; font-size: 22px; margin-bottom: 5px; }
        .star-active { color: #f1c40f; text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }
        .menu-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 12px; }
        .menu-item { display: flex; align-items: center; padding: 18px 20px; border-radius: 15px; border: none; color: white; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; text-decoration: none; }
        .menu-item i { width: 30px; font-size: 18px; text-align: center; margin-left: 10px; }
        .menu-item span { flex-grow: 1; text-align: center; }
        .q-card { background: var(--card); padding: 25px; border-radius: 25px; width: 100%; max-width: 400px; text-align: center; }
        .ans-input { width: 90%; padding: 15px; border-radius: 12px; border: 2px solid var(--blue); background: var(--bg); color: var(--text); text-align: center; font-size: 18px; margin-bottom: 15px; outline: none; }
        .progress-bar-container { width: 100%; max-width: 400px; background: #334155; height: 8px; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--green); width: 0%; transition: 0.4s; }
        .hidden { display: none; }
        .box-info { text-align: right; background: rgba(0,168,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-right: 4px solid var(--blue); }
    </style>
</head>
<body>
    <div class="top-bar">
        <button class="control-btn" onclick="UI.toggleTheme()"><i id="themeIcon" class="fas fa-moon"></i></button>
        <button class="control-btn" onclick="UI.toggleMute()"><i id="muteIcon" class="fas fa-volume-up"></i></button>
    </div>
    <div id="setup-screen" style="width:100%; display:flex; flex-direction:column; align-items:center;">
        <h1>English with Fred</h1>
        <div class="header-box">
            <div class="stars" id="mainStars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
            <input type="text" id="userName" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
            <button id="loginBtn" onclick="Engine.login()" style="width: 90%; padding: 12px; margin-top: 15px; border-radius: 10px; border: none; background: var(--blue); color: white; font-weight: bold; cursor: pointer;">ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„</button>
        </div>
        <div id="menuOptions" class="menu-container hidden">
            <button class="menu-item" style="background: var(--purple);" onclick="Engine.start('study')"><i class="fas fa-graduation-cap"></i><span>Ø¢Ù…ÙˆØ²Ø´ Ù„ØºØ§Øª (Study Mode)</span></button>
            <button class="menu-item" style="background: var(--blue);" onclick="Engine.start('fa-en')"><i class="fas fa-exchange-alt"></i><span>Persian â†’ English</span></button>
            <button class="menu-item" style="background: var(--green);" onclick="Engine.start('word-def')"><i class="fas fa-book"></i><span>Word â†’ Definition</span></button>
            <button class="menu-item" style="background: var(--orange);" onclick="Engine.start('review')"><i class="fas fa-sync-alt"></i><span>Ù…Ø±ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª</span></button>
            <button class="menu-item" style="background: var(--red);" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i><span>Ø®Ø±ÙˆØ¬</span></button>
        </div>
    </div>
    <div id="quiz-screen" class="hidden" style="width:100%; max-width:400px; display:flex; flex-direction:column; align-items:center;">
        <div class="progress-bar-container"><div id="progressBar" class="progress-bar-fill"></div></div>
        <div id="quiz-content" style="width:100%;"></div>
    </div>
    <script src="a1-words.js"></script>
    <script>
        const MY_TOKEN = "8553224514:AAG0XXzA8da55jCGXnzStP-0IxHhnfkTPRw";
        const MY_CHAT_ID = "96991859";
        let isMuted = false;
        let session = { mode: '', questions: [], index: 0, score: 0, mistakes: [] };
        const UI = {
            toggleTheme() { document.body.classList.toggle('light-mode'); document.getElementById('themeIcon').className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon'; },
            toggleMute() { isMuted = !isMuted; const icon = document.getElementById('muteIcon'); icon.className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up'; icon.style.color = isMuted ? '#d63031' : '#00a8ff'; }
        };
        window.onload = () => {
            const lastScore = localStorage.getItem('lastScore') || 0;
            const stars = document.getElementById('mainStars').children;
            const activeCount = Math.floor(lastScore / 2);
            for(let i=0; i<5; i++) stars[i].className = i < activeCount ? "fas fa-star star-active" : "fas fa-star";
            if(localStorage.getItem('fredName')) document.getElementById('userName').value = localStorage.getItem('fredName');
        };
        const Engine = {
            login() { const name = document.getElementById('userName').value.trim(); if(!name) return alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); localStorage.setItem('fredName', name); document.getElementById('loginBtn').classList.add('hidden'); document.getElementById('userName').disabled = true; document.getElementById('menuOptions').classList.remove('hidden'); },
            start(mode) {
                session.mode = mode; session.index = 0; session.score = 0; session.mistakes = [];
                if(mode === 'review') {
                    const saved = JSON.parse(localStorage.getItem('mistakes') || "[]");
                    if(saved.length === 0) return alert("Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡!");
                    session.questions = saved.sort(() => 0.5 - Math.random()).slice(0, 10);
                } else { session.questions = [...window.wordsA1].sort(() => 0.5 - Math.random()).slice(0, 10); }
                document.getElementById('setup-screen').classList.add('hidden');
                document.getElementById('quiz-screen').classList.remove('hidden');
                this.render();
            },
            render() {
                const q = session.questions[session.index];
                document.getElementById('progressBar').style.width = ((session.index + 1) / session.questions.length * 100) + "%";
                let html = '';
                if(session.mode === 'study') {
                    html = `<div class="q-card">
                        <div style="font-size:40px; color:var(--blue); font-weight:bold;">${q.word}</div>
                        <div style="color:var(--gray); margin-bottom:20px;">${q.translation}</div>
                        <div class="box-info"><small>EXAMPLE</small><div>${q.ex_en}</div><div style="font-size:13px; color:var(--gray)">${q.ex_fa}</div></div>
                        <div class="box-info" style="border-right-color:var(--green)"><small>COLLOCATION</small><div>${q.coll_en}</div><div style="font-size:13px; color:var(--gray)">${q.coll_fa}</div></div>
                        <button class="menu-item" style="background:var(--blue); width:100%; margin-top:15px; justify-content:center;" onclick="Engine.next()">Ø¨Ø¹Ø¯ÛŒ</button>
                    </div>`;
                } else {
                    let qTxt = session.mode === 'fa-en' ? q.translation : q.word;
                    html = `<div class="q-card">
                        <div style="font-size:32px; color:var(--blue); margin-bottom:25px;">${qTxt}</div>
                        <input type="text" id="ansInput" class="ans-input" placeholder="Ù¾Ø§Ø³Ø®..." autocomplete="off">
                        <button class="menu-item" style="background:var(--blue); width:100%; justify-content:center;" onclick="Engine.check()">Ø«Ø¨Øª</button>
                    </div>`;
                }
                document.getElementById('quiz-content').innerHTML = html;
                if(document.getElementById('ansInput')) document.getElementById('ansInput').focus();
            },
            check() {
                const val = document.getElementById('ansInput').value.trim().toLowerCase();
                const correct = session.questions[session.index].word.toLowerCase();
                if(val === correct) session.score++;
                else {
                    let mists = JSON.parse(localStorage.getItem('mistakes') || "[]");
                    if(!mists.find(x => x.id === session.questions[session.index].id)) {
                        mists.push(session.questions[session.index]);
                        localStorage.setItem('mistakes', JSON.stringify(mists));
                    }
                }
                this.next();
            },
            next() { session.index++; if(session.index < session.questions.length) this.render(); else this.finish(); },
            async finish() {
                if(session.mode !== 'study') {
                    localStorage.setItem('lastScore', session.score);
                    const msg = `ðŸ“Š Ú¯Ø²Ø§Ø±Ø´: ${localStorage.getItem('fredName')}\nðŸŽ¯ Ù†Ù…Ø±Ù‡: ${session.score} Ø§Ø² ${session.questions.length}\nðŸ›  Ø­Ø§Ù„Øª: ${session.mode}`;
                    fetch(`https://api.telegram.org/bot${MY_TOKEN}/sendMessage?chat_id=${MY_CHAT_ID}&text=${encodeURIComponent(msg)}`);
                }
                alert("Ù¾Ø§ÛŒØ§Ù† ØªÙ…Ø±ÛŒÙ†"); location.reload();
            }
        };
    </script>
</body>
</html>
